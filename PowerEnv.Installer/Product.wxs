<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?define ProductName="PowerEnv" ?>
  <?define ProductVersion="1.0.0.0" ?>
  <?define ProductCode="FC0D9C67-DE9C-40D3-892F-57CF5EA89BD6"?>
  <?define UpgradeCode="0796F069-E912-4156-82C9-422D7848175D"?>
  <?define Manufacturer="Shogun"?>

  <Product
    Id="$(var.ProductCode)"
    Name="$(var.ProductName)"
    Language="1033"
    Version="$(var.ProductVersion)"
    Manufacturer="$(var.Manufacturer)"
    UpgradeCode="$(var.UpgradeCode)">

    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes"/>

    <Feature Id="PowerEnvFeature"
             Title="Install everything"
             Description="Installs all powershell functions, scripts, modules etc."
             Level="1"
             ConfigurableDirectory="PRODUCTFOLDER">
      <ComponentRef Id="EnvComponent" />
      <ComponentRef Id="InitializeEnvComponent" />
    </Feature>

  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="PRODUCTFOLDER" Name="$(var.ProductName)">
          <Directory Id="FUNCTIONS" Name="Functions"/>
        </Directory>
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>

    <DirectoryRef Id="PRODUCTFOLDER" FileSource ="..\PowerEnv\" DiskId='1'>
      <Component Id="InitializeEnvComponent" Guid="A64822F4-12AC-4208-8C7A-4D588209DA93" KeyPath="yes">
        <File Id="InitializeEnv.ps1" Name="InitializeEnv.ps1"/>
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="FUNCTIONS" FileSource ="..\PowerEnv\Functions\" DiskId='1'>
      <Component Id="EnvComponent" Guid="F5193FA4-BC3D-4D60-843E-C9A4EFA163A9" KeyPath="yes">
        <File Id="Env.ps1" Name="Env.ps1"/>
      </Component>
    </DirectoryRef>

  </Fragment>

</Wix>
